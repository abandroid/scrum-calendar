{% extends 'EndroidCalendarScrumBundle::layout.html.twig' %}

{% block content %}
    <div id="chartContainer" style="height: 400px; width: 100%;">
{% endblock %}

{% block javascripts %}

    {{ parent() }}

    <script src="https://cdnjs.cloudflare.com/ajax/libs/canvasjs/1.7.0/canvasjs.min.js"></script>

    {% set sprint = sprintDefinition.sprint %}

    <script type="text/javascript">
        window.onload = function() {
            let chart = new CanvasJS.Chart("chartContainer", {
                title: {
                    text: "",
                    margin: 0
                },
                toolTip: {
                    shared: true
                },
                axisX: {
                    valueFormatString: "D-MMM",
                    interval: {{ sprint.dayCount / 10 }},
                    intervalType: "day"
                },
                legend: {
                    verticalAlign: "bottom",
                    horizontalAlign: "center"
                },
                data: [
                    {
                        type: "stackedArea",
                        name: "{{ sprintDefinition.label }}",
                        showInLegend: "false",
                        dataPoints: [
                            {% set max = 0 %}
                            {% set cumulative = 0 %}
                            {% for date, userStories in sprint.userStoriesByDay %}
                                {% set tooltip = userStories|keys|join('<br />') %}
                                {% set dayCumulative = 0 %}
                                {% for storyPoints in userStories %}
                                    {% set dayCumulative = dayCumulative + storyPoints %}
                                {% endfor %}
                                {% set cumulative = cumulative + dayCumulative %}
                                {% set max = max(max, cumulative) %}

                                {x: new Date('{{ date }}'), y: {{ cumulative }}, indexLabelOrientation: 'vertical', indexLabel: "{% if date == 'now'|date('Y-m-d') %}Today{% endif %}", toolTipContent: "{{ tooltip|raw }}" }{% if not loop.last %},{% endif %}
                            {% endfor %}
                        ]
                    }
                ],
                axisY: {
                    maximum: {{ max + 10 }},
                    interval: {{ (max / 10)|round(0, 'ceil') }}
                },
            });

            chart.render();
        }
    </script>

{% endblock %}