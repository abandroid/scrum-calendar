{% extends 'EndroidCalendarScrumBundle::layout.html.twig' %}

{% block content %}
    <div id="chartContainer" style="height: 400px; width: 100%;">
{% endblock %}

{% block javascripts %}

    {{ parent() }}

    <script src="http://canvasjs.com/assets/script/canvasjs.min.js"></script>

    <script type="text/javascript">
        window.onload = function() {
            var chart = new CanvasJS.Chart("chartContainer", {
                title: {
                    text: "",
                    margin: 0
                },
                toolTip: {
                    shared: true
                },
                axisX: {
                    valueFormatString: "D-MMM",
                    interval: {{ sprint.durationInDays|length / 10 }},
                    intervalType: "day"
                },
                legend: {
                    verticalAlign: "bottom",
                    horizontalAlign: "center"
                },
                data: [
                    {
                        type: "stackedArea",
                        name: "story points",
                        showInLegend: "false",
                        dataPoints: [
                            {% set max = 0 %}
                            {% set month = null %}
                            {% set cumulative = 0 %}
                            {% for day in sprint.durationInDays %}
                                {% set m = day.date|date('m') %}
                                {% if m != month %}
                                    {% set month = m %}
                                    {% set cumulative = 0 %}
                                {% endif %}
                                {% set cumulative = cumulative + day.total %}
                                {% set max = max(max, cumulative) %}
                                {% if loop.index > 1 %},{% endif %}{x: new Date({{ day.date|date('Y') }}, {{ day.date|date('m') - 1 }}, {{ day.date|date('d') }}), y: {{ cumulative }}, indexLabelOrientation: 'vertical', indexLabel: "{{ day.label }}", toolTipContent: "{{ day.tooltip|raw }}" }
                            {% endfor %}
                        ]
                    }
                ],
                axisY: {
                    maximum: {{ max + 10 }},
                    interval: {{ (sprint.cumulative / 10)|round(0, 'ceil') }}
                },
            });

            chart.render();
        }
    </script>

{% endblock %}